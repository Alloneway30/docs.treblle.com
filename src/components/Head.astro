---
import type { Props } from "@astrojs/starlight/props";
// Don't import the default head - we'll build our own
// import Default from "@astrojs/starlight/components/Head.astro"

const ogImageUrl = new URL(
  `/og/${Astro.props.id.replace(/\.\w+$/, '.png')}`,
  Astro.site,
);

// Get the custom meta title if it exists, otherwise use the page title
const metaTitle = Astro.props.entry.data.metaTitle || Astro.props.entry.data.title;
const description = Astro.props.entry.data.description;
const canonical = new URL(Astro.url.pathname, Astro.site).href;
---

<!-- Build our custom head from scratch -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="robots" content="index,follow" />

<!-- Title tag without Starlight's formatting -->
<title>{metaTitle}</title>

<!-- Meta tags -->
<meta name="description" content={description} />
<meta name="generator" content={Astro.generator} />

<!-- Canonical URL -->
<link rel="canonical" href={canonical} />

<!-- Favicons -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />

<!-- Open Graph / Social media tags -->
<meta property="og:title" content={metaTitle} />
<meta property="og:description" content={description} />
<meta property="og:url" content={canonical} />
<meta property="og:type" content="article" />
{
  Astro.props.entry.data.image
  ? (
    <meta property="og:image" content={new URL(Astro.props.entry.data.image, Astro.site).href} /> 
    <meta name="twitter:image" content={new URL(Astro.props.entry.data.image, Astro.site).href} />
  )
  : (
    <meta property="og:image" content={ogImageUrl.href} />
    <meta name="twitter:image" content={ogImageUrl.href} />
  )
}

<!-- Twitter cards -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={metaTitle} />
<meta name="twitter:description" content={description} />
<meta property="twitter:domain" content={Astro.site.host} />
<meta property="twitter:url" content={canonical} />

<!-- Sitemap -->
<link rel="sitemap" href="/sitemap-index.xml" />

<!-- Analytics -->
<script is:inline async src="https://www.googletagmanager.com/gtag/js?id=G-QF2CWF97TK"></script>
<script is:inline>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QF2CWF97TK');
</script>

<!-- Google Tag Manager (noscript) -->
<noscript>
  <iframe
    src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX"
    height="0"
    width="0"
    style="display:none;visibility:hidden"
  ></iframe>
</noscript>

<!-- Pass through any injected head content -->
<slot />