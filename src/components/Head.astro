---
import type { Props } from "@astrojs/starlight/props";
import Default from "@astrojs/starlight/components/Head.astro";

const defaultOgImage = new URL("/og/default.png", Astro.site).toString();
const pageImage = Astro.props.entry.data.image
  ? new URL(Astro.props.entry.data.image, Astro.site).toString()
  : new URL(
      `/og/${Astro.props.id.replace(/\.\w+$/, ".png")}`,
      Astro.site,
    ).toString();

// Add a version parameter to force Slack cache refresh
const ogImageUrl = `${pageImage}?v=1`;
---

<Default {...Astro.props}><slot /></Default>

<!-- Open Graph Meta Tags -->
<meta property="og:image" content={ogImageUrl} />
<meta property="og:image:secure_url" content={ogImageUrl} />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />

<!-- Twitter Meta Tags -->
<meta name="twitter:image" content={ogImageUrl} />
<meta name="twitter:card" content="summary_large_image" />

<link rel="sitemap" href="/sitemap-index.xml" />

<!-- Google Analytics -->
<script
  is:inline
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-QF2CWF97TK"></script>

<script is:inline>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "G-QF2CWF97TK");
</script>

<!-- Google Tag Manager (noscript) -->
<noscript>
  <iframe
    src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX"
    height="0"
    width="0"
    style="display:none;visibility:hidden"
  >
  </iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->
